{% extends "base.html" %}

{% block title %}iXecSync - Files{% endblock %}


{% block head %}
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/file_browser.css') }}" />
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/header.css') }}" />
<script src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
{% endblock %}

{% block content %}
<main>
   {% include "header.html" %}
   <section class="file-overview">
      <section id='search' class='category'>
         <span>Search</span>
         <section class="item search">
            <input type="text" placeholder="search" onkeydown="search(this)">
         </section>
      </section>
      {% if not folders and not files %}
      <section class="category">
         <span>Files</span>
         <ul class="file_browser">
            {% for item in empty %}
            <li class="file item error-message">
               <span>{{ item.name }}</span>
            </li>
            {% endfor %}
         </ul>
      </section>
      {% endif %}
      {% if folders %}
      <section class="category">
         <span>Folders</span>
         <ul class="file_browser">
            {% for item in folders %}
            <li class="folder item" onclick='navigate(this.id)' id='{{ item.path }}' data-type='{{ item.type }}'>
               <span>{{ item.name }}</span>
            </li>
            {% endfor %}
         </ul>
      </section>
      {% endif %}
      {% if files %}
      <section class="category">
         <span>Files</span>
         <ul class="file_browser">
            {% for item in files %}
            <li class="file item file-{{ item.format }}" onclick='navigate(this.id)' id='{{ item.path }}'
               data-type='{{ item.type }}'>
               <span>{{ item.name }}</span>
            </li>
            {% endfor %}
         </ul>
      </section>
      {% endif %}
   </section>
</main>
{% endblock %}


{% block scripts_bottom %}
<script>
   function RemoveLastDirectoryPartOf(the_url) {
      var the_arr = the_url.split('/');
      the_arr.pop();
      the_arr.pop();
      return (the_arr.join('/'));
   }

   function toggle_search() {
      $("#search").slideToggle(300);
   }

   function goBack() {
      var back = RemoveLastDirectoryPartOf(window.location.href)
      window.location.href = back
   }

   function navigate(id) {
      //redirect_url = window.location.href.slice(-1) == "/" ? window.location.href + id : window.location.href + "/" + id
      var item = document.getElementById(id)
      var type = item.getAttribute('data-type')
      var redirect = "/file/" + id
      if (type == 'folder') {
         redirect = redirect + "/"
      }
      window.location.href = redirect
   }

   function search(input) {
      if (event.key === 'Enter') {
         window.location.href = "/search/" + input.value
      }
   }
</script>
{% endblock %}