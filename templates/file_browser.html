{% extends "base.html" %}

{% block title %}iXecSync - Files{% endblock %}


{% block head %}
{{ super() }}
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/file_browser.css') }}" />
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/header.css') }}" />
{% endblock %}


{% block content %}
<main class="grid">
   {% include "header.html" %}
   <!-- <nav>
      <ul class="nav">
         <li onclick="goBack()">Back</li>
      </ul>
   </nav> -->
   <section class="scrolling">
      <ul class="file_browser">
         {% for item in folders %}
         <li class="folder item" onclick='navigate(this.id)' id='{{ item.path }}' data-type='{{ item.type }}'>
            {{ item.name }}
         </li>
         {% endfor %}

         {% for item in files %}
         <li class="file item file-{{ item.format }}" onclick='navigate(this.id)' id='{{ item.path }}'
            data-type='{{ item.type }}'>
            {{ item.name }}
         </li>
         {% endfor %}

         {% for item in empty %}
         <li class="file item file-other">
            {{ item.name }}
         </li>
         {% endfor %}
      </ul>
   </section>
</main>
{% endblock %}


{% block scripts %}
<script>
   function RemoveLastDirectoryPartOf(the_url) {
      var the_arr = the_url.split('/');
      the_arr.pop();
      the_arr.pop();
      return (the_arr.join('/'));
   }

   function goBack() {
      var back = RemoveLastDirectoryPartOf(window.location.href)
      window.location.href = back
   }

   function navigate(id) {
      //redirect_url = window.location.href.slice(-1) == "/" ? window.location.href + id : window.location.href + "/" + id
      var item = document.getElementById(id)
      var type = item.getAttribute('data-type')
      var redirect = "/file/" + id
      if (type == 'folder') {
         redirect = redirect + "/"
      }
      window.location.href = redirect
   }
</script>
{% endblock %}